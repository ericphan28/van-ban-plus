<Page x:Class="AIVanBan.Desktop.Views.BackupRestorePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Sao lÆ°u &amp; KhÃ´i phá»¥c">

    <Grid Margin="30,20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="DatabaseExport" Width="32" Height="32"
                                        VerticalAlignment="Center" Margin="0,0,12,0"
                                        Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                <TextBlock Text="SAO LÆ¯U &amp; KHÃ”I PHá»¤C" FontSize="24" FontWeight="Bold"
                          VerticalAlignment="Center"/>
            </StackPanel>
            <TextBlock Text="Báº£o vá»‡ dá»¯ liá»‡u vÄƒn báº£n, album áº£nh, cuá»™c há»p vÃ  máº«u vÄƒn báº£n cá»§a báº¡n"
                      FontSize="13" Foreground="{DynamicResource MaterialDesignBodyLight}"
                      Margin="44,4,0,0"/>
        </StackPanel>

        <!-- Data Info + Action Buttons -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Data Size Card -->
            <materialDesign:Card Grid.Column="0" Padding="20" Margin="0,0,10,0"
                                materialDesign:ElevationAssist.Elevation="Dp2">
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Database" Width="24" Height="24"
                                                Foreground="#2196F3" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Dá»¯ liá»‡u hiá»‡n táº¡i" FontSize="14" FontWeight="SemiBold"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                    <TextBlock x:Name="txtDataSize" Text="Äang tÃ­nh..." FontSize="20" FontWeight="Bold"
                              Margin="0,10,0,2" Foreground="#2196F3"/>
                    <TextBlock x:Name="txtDataDetails" Text="" FontSize="11" Foreground="Gray"
                              TextWrapping="Wrap"/>
                    <TextBlock x:Name="txtDataPath" Text="" FontSize="11" TextTrimming="CharacterEllipsis"
                              Foreground="Gray" Margin="0,2,0,0"
                              ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Backup Button Card -->
            <materialDesign:Card Grid.Column="1" Padding="20" Margin="5,0,5,0"
                                materialDesign:ElevationAssist.Elevation="Dp2">
                <StackPanel HorizontalAlignment="Center">
                    <Button x:Name="btnBackup" Style="{StaticResource MaterialDesignRaisedButton}"
                           Background="#4CAF50" BorderBrush="#4CAF50"
                           Padding="24,10" Click="BtnBackup_Click" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ContentSave" Width="20" Height="20"
                                                    VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="Sao lÆ°u ngay" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="Táº¡o báº£n sao lÆ°u thá»§ cÃ´ng" FontSize="11" Margin="0,8,0,0"
                              HorizontalAlignment="Center" Foreground="Gray"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Restore Button Card -->
            <materialDesign:Card Grid.Column="2" Padding="20" Margin="10,0,0,0"
                                materialDesign:ElevationAssist.Elevation="Dp2">
                <StackPanel HorizontalAlignment="Center">
                    <Button x:Name="btnRestore" Style="{StaticResource MaterialDesignRaisedButton}"
                           Background="#FF9800" BorderBrush="#FF9800"
                           Padding="24,10" Click="BtnRestore_Click" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="DatabaseImport" Width="20" Height="20"
                                                    VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="KhÃ´i phá»¥c" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="Phá»¥c há»“i tá»« báº£n sao lÆ°u" FontSize="11" Margin="0,8,0,0"
                              HorizontalAlignment="Center" Foreground="Gray"/>
                </StackPanel>
            </materialDesign:Card>
        </Grid>

        <!-- Auto backup info -->
        <materialDesign:Card Grid.Row="2" Padding="16" Margin="0,0,0,16"
                            materialDesign:ElevationAssist.Elevation="Dp1">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="ShieldCheck" Width="20" Height="20"
                                        Foreground="#4CAF50" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock x:Name="txtAutoBackupStatus" 
                          Text="Tá»± Ä‘á»™ng sao lÆ°u: Äang kiá»ƒm tra..."
                          FontSize="13" VerticalAlignment="Center"/>
                <Button x:Name="btnOpenBackupFolder" Style="{StaticResource MaterialDesignFlatButton}"
                       Content="ðŸ“‚ Má»Ÿ thÆ° má»¥c backup" Margin="20,0,0,0"
                       Click="BtnOpenBackupFolder_Click" FontSize="12"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Backup History List -->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <materialDesign:PackIcon Kind="History" Width="22" Height="22"
                                        VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBlock Text="Lá»‹ch sá»­ sao lÆ°u" FontSize="16" FontWeight="SemiBold"
                          VerticalAlignment="Center"/>
                <Button x:Name="btnRefresh" Style="{StaticResource MaterialDesignIconButton}"
                       ToolTip="LÃ m má»›i" Margin="10,0,0,0" Click="BtnRefresh_Click">
                    <materialDesign:PackIcon Kind="Refresh"/>
                </Button>
            </StackPanel>

            <DataGrid Grid.Row="1" x:Name="dgBackups" AutoGenerateColumns="False"
                     IsReadOnly="True" CanUserAddRows="False" CanUserDeleteRows="False"
                     SelectionMode="Single" HeadersVisibility="Column"
                     materialDesign:DataGridAssist.CellPadding="12 8"
                     materialDesign:DataGridAssist.ColumnHeaderPadding="12 8"
                     GridLinesVisibility="Horizontal"
                     HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Loáº¡i" Binding="{Binding TypeLabel}" Width="80"/>
                    <DataGridTextColumn Header="TÃªn file" Binding="{Binding FileName}" Width="*"/>
                    <DataGridTextColumn Header="Dung lÆ°á»£ng" Binding="{Binding FileSizeFormatted}" Width="100"/>
                    <DataGridTextColumn Header="NgÃ y táº¡o" Binding="{Binding CreatedDate, StringFormat='dd/MM/yyyy HH:mm'}" Width="150"/>
                    <DataGridTemplateColumn Header="Thao tÃ¡c" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="KhÃ´i phá»¥c tá»« báº£n nÃ y"
                                           Click="BtnRestoreFromList_Click"
                                           Tag="{Binding FilePath}">
                                        <materialDesign:PackIcon Kind="DatabaseImport" Foreground="#FF9800"/>
                                    </Button>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="Má»Ÿ thÆ° má»¥c chá»©a"
                                           Click="BtnOpenFileLocation_Click"
                                           Tag="{Binding FilePath}">
                                        <materialDesign:PackIcon Kind="FolderOpen" Foreground="#2196F3"/>
                                    </Button>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="XÃ³a báº£n backup nÃ y"
                                           Click="BtnDeleteBackup_Click"
                                           Tag="{Binding FilePath}">
                                        <materialDesign:PackIcon Kind="Delete" Foreground="#F44336"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>
