<Page x:Class="AIVanBan.Desktop.Views.StatisticsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="BÃ¡o cÃ¡o thá»‘ng kÃª"
      Background="#F5F5F5">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- HEADER -->
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel>
                    <TextBlock Text="ðŸ“‹ BÃ¡o cÃ¡o thá»‘ng kÃª vÄƒn báº£n" FontSize="22" FontWeight="Bold" Foreground="#37474F"/>
                    <TextBlock x:Name="txtPeriodInfo" Text="" FontSize="12" Foreground="#888" Margin="0,4,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <ComboBox x:Name="cboPeriod" Width="160" Margin="0,0,12,0"
                              materialDesign:HintAssist.Hint="Ká»³ bÃ¡o cÃ¡o"
                              SelectionChanged="Period_Changed"
                              SelectedIndex="1">
                        <ComboBoxItem Content="Tuáº§n nÃ y"/>
                        <ComboBoxItem Content="ThÃ¡ng nÃ y"/>
                        <ComboBoxItem Content="QuÃ½ nÃ y"/>
                        <ComboBoxItem Content="NÄƒm nay"/>
                        <ComboBoxItem Content="Táº¥t cáº£"/>
                    </ComboBox>
                    
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}" 
                            Height="36" Click="ExportCsv_Click" Margin="0,0,8,0"
                            ToolTip="Xuáº¥t danh sÃ¡ch VB theo ká»³ ra CSV">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FileExport" Width="18" Height="18" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBlock Text="Xuáº¥t CSV" FontSize="12"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                            Height="36" Click="ExportExcel_Click" Margin="0,0,8,0"
                            Background="#217346" BorderBrush="#217346"
                            ToolTip="Xuáº¥t bÃ¡o cÃ¡o thá»‘ng kÃª tá»•ng há»£p ra Excel (.xlsx)">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="MicrosoftExcel" Width="18" Height="18" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBlock Text="Xuáº¥t Excel" FontSize="12"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource MaterialDesignRaisedSecondaryButton}" 
                            Height="36" Click="Refresh_Click">
                        <materialDesign:PackIcon Kind="Refresh"/>
                    </Button>
                </StackPanel>
            </Grid>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- PHáº¦N 1: SO SÃNH Ká»² TRÆ¯á»šC â€” Chá»‰ cÃ³ á»Ÿ Thá»‘ng kÃª    -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <materialDesign:Card Padding="20" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="ðŸ“Š SO SÃNH Vá»šI Ká»² TRÆ¯á»šC" FontSize="13" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,14"/>
                    
                    <UniformGrid Columns="4">
                        <!-- VB Äáº¿n: ká»³ nÃ y vs ká»³ trÆ°á»›c -->
                        <Border BorderBrush="#E0E0E0" BorderThickness="0,0,1,0" Padding="0,0,16,0" Margin="0,0,8,0">
                            <StackPanel>
                                <TextBlock Text="VB Äáº¿n" FontSize="11" Foreground="#888" FontWeight="SemiBold"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock x:Name="txtCompDen" Text="0" FontSize="24" FontWeight="Bold" Foreground="#E65100"/>
                                    <TextBlock x:Name="txtCompDenDelta" Text="" FontSize="12" Foreground="#888"
                                              VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                                </StackPanel>
                                <TextBlock x:Name="txtCompDenPrev" Text="Ká»³ trÆ°á»›c: 0" FontSize="11" Foreground="#AAA"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- VB Äi -->
                        <Border BorderBrush="#E0E0E0" BorderThickness="0,0,1,0" Padding="0,0,16,0" Margin="0,0,8,0">
                            <StackPanel>
                                <TextBlock Text="VB Äi" FontSize="11" Foreground="#888" FontWeight="SemiBold"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock x:Name="txtCompDi" Text="0" FontSize="24" FontWeight="Bold" Foreground="#2E7D32"/>
                                    <TextBlock x:Name="txtCompDiDelta" Text="" FontSize="12" Foreground="#888"
                                              VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                                </StackPanel>
                                <TextBlock x:Name="txtCompDiPrev" Text="Ká»³ trÆ°á»›c: 0" FontSize="11" Foreground="#AAA"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Ná»™i bá»™ -->
                        <Border BorderBrush="#E0E0E0" BorderThickness="0,0,1,0" Padding="0,0,16,0" Margin="0,0,8,0">
                            <StackPanel>
                                <TextBlock Text="Ná»™i bá»™" FontSize="11" Foreground="#888" FontWeight="SemiBold"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock x:Name="txtCompNB" Text="0" FontSize="24" FontWeight="Bold" Foreground="#6A1B9A"/>
                                    <TextBlock x:Name="txtCompNBDelta" Text="" FontSize="12" Foreground="#888"
                                              VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                                </StackPanel>
                                <TextBlock x:Name="txtCompNBPrev" Text="Ká»³ trÆ°á»›c: 0" FontSize="11" Foreground="#AAA"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Tá»•ng -->
                        <StackPanel>
                            <TextBlock Text="Tá»•ng cá»™ng" FontSize="11" Foreground="#888" FontWeight="SemiBold"/>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock x:Name="txtCompTotal" Text="0" FontSize="24" FontWeight="Bold" Foreground="#37474F"/>
                                <TextBlock x:Name="txtCompTotalDelta" Text="" FontSize="12" Foreground="#888"
                                          VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                            </StackPanel>
                            <TextBlock x:Name="txtCompTotalPrev" Text="Ká»³ trÆ°á»›c: 0" FontSize="11" Foreground="#AAA"/>
                        </StackPanel>
                    </UniformGrid>
                </StackPanel>
            </materialDesign:Card>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- PHáº¦N 2: HIá»†U SUáº¤T Xá»¬ LÃ â€” Dashboard khÃ´ng cÃ³    -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <materialDesign:Card Padding="20" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="â±ï¸ HIá»†U SUáº¤T Xá»¬ LÃ VÄ‚N Báº¢N Äáº¾N" FontSize="13" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,14"/>
                    
                    <UniformGrid Columns="4">
                        <StackPanel Margin="0,0,12,0">
                            <TextBlock Text="Tá»•ng VB cÃ³ háº¡n" FontSize="11" Foreground="#888"/>
                            <TextBlock x:Name="txtPerfTotal" Text="0" FontSize="22" FontWeight="Bold" Foreground="#1565C0" Margin="0,2,0,0"/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,0">
                            <TextBlock Text="âœ… ÄÃºng háº¡n" FontSize="11" Foreground="#888"/>
                            <TextBlock x:Name="txtPerfOnTime" Text="0" FontSize="22" FontWeight="Bold" Foreground="#2E7D32" Margin="0,2,0,0"/>
                            <TextBlock x:Name="txtPerfOnTimeRate" Text="- %" FontSize="12" Foreground="#2E7D32"/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,0">
                            <TextBlock Text="âš  QuÃ¡ háº¡n" FontSize="11" Foreground="#888"/>
                            <TextBlock x:Name="txtPerfOverdue" Text="0" FontSize="22" FontWeight="Bold" Foreground="#C62828" Margin="0,2,0,0"/>
                            <TextBlock x:Name="txtPerfOverdueRate" Text="- %" FontSize="12" Foreground="#C62828"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="TB ngÃ y xá»­ lÃ½" FontSize="11" Foreground="#888"/>
                            <TextBlock x:Name="txtPerfAvgDays" Text="-" FontSize="22" FontWeight="Bold" Foreground="#FF8F00" Margin="0,2,0,0"/>
                            <TextBlock Text="ngÃ y/VB" FontSize="12" Foreground="#FF8F00"/>
                        </StackPanel>
                    </UniformGrid>
                </StackPanel>
            </materialDesign:Card>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- PHáº¦N 3: Báº¢NG Tá»”NG Há»¢P â€” dáº¡ng báº£ng bÃ¡o cÃ¡o       -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Grid Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Báº£ng: Theo loáº¡i VB -->
                <materialDesign:Card Grid.Column="0" Padding="20">
                    <StackPanel>
                        <TextBlock Text="PHÃ‚N LOáº I VÄ‚N Báº¢N TRONG Ká»²" FontSize="12" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,10"/>
                        <DataGrid x:Name="dgByType" AutoGenerateColumns="False" 
                                  IsReadOnly="True" CanUserAddRows="False"
                                  GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E0E0E0"
                                  RowHeight="32" HeadersVisibility="Column" MaxHeight="350">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Loáº¡i vÄƒn báº£n" Binding="{Binding TypeName}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Padding" Value="4,0"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Äáº¿n" Binding="{Binding Den}" Width="55">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Foreground" Value="#E65100"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Äi" Binding="{Binding Di}" Width="55">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Foreground" Value="#2E7D32"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="NB" Binding="{Binding NoiBo}" Width="55">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Foreground" Value="#6A1B9A"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Tá»•ng" Binding="{Binding Total}" Width="55">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>
                
                <!-- Báº£ng: Theo má»©c Ä‘á»™ kháº©n + Ä‘á»™ máº­t -->
                <materialDesign:Card Grid.Column="2" Padding="20">
                    <StackPanel>
                        <TextBlock Text="Má»¨C Äá»˜ KHáº¨N" FontSize="12" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,10"/>
                        <DataGrid x:Name="dgByUrgency" AutoGenerateColumns="False" 
                                  IsReadOnly="True" CanUserAddRows="False"
                                  GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E0E0E0"
                                  RowHeight="32" HeadersVisibility="Column" MaxHeight="200">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Má»©c Ä‘á»™" Binding="{Binding Label}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Padding" Value="4,0"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Sá»‘ lÆ°á»£ng" Binding="{Binding Count}" Width="80">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Tá»· lá»‡" Binding="{Binding Percent}" Width="70">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Foreground" Value="#666"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <Separator Margin="0,14"/>
                        
                        <TextBlock Text="Äá»˜ Máº¬T" FontSize="12" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,8"/>
                        <DataGrid x:Name="dgBySecurity" AutoGenerateColumns="False" 
                                  IsReadOnly="True" CanUserAddRows="False"
                                  GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E0E0E0"
                                  RowHeight="32" HeadersVisibility="Column" MaxHeight="180">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Äá»™ máº­t" Binding="{Binding Label}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Padding" Value="4,0"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Sá»‘ lÆ°á»£ng" Binding="{Binding Count}" Width="80">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Tá»· lá»‡" Binding="{Binding Percent}" Width="70">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="Foreground" Value="#666"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- PHáº¦N 4: Báº¢NG XU HÆ¯á»šNG 12 THÃNG                   -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <materialDesign:Card Padding="20" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="ðŸ“ˆ DIá»„N BIáº¾N 12 THÃNG Gáº¦N NHáº¤T" FontSize="12" FontWeight="Bold" Foreground="#37474F" Margin="0,0,0,10"/>
                    <DataGrid x:Name="dgMonthlyTrend" AutoGenerateColumns="False" 
                              IsReadOnly="True" CanUserAddRows="False"
                              GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E0E0E0"
                              RowHeight="34" HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ThÃ¡ng" Binding="{Binding Month}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="Padding" Value="4,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="VB Äáº¿n" Binding="{Binding Den}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="Foreground" Value="#E65100"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="VB Äi" Binding="{Binding Di}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Ná»™i bá»™" Binding="{Binding NoiBo}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="Foreground" Value="#6A1B9A"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Tá»•ng" Binding="{Binding Total}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="#1565C0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Â± Ká»³ trÆ°á»›c" Binding="{Binding DeltaText}" Width="90">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>
            
        </StackPanel>
    </ScrollViewer>
</Page>
