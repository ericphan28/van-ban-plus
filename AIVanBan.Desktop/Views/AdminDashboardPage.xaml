<Page x:Class="AIVanBan.Desktop.Views.AdminDashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Admin Dashboard">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryHueMidBrush}" Padding="20,16">
            <DockPanel>
                <StackPanel>
                    <TextBlock Text="ðŸ›¡ï¸ Admin Dashboard" FontSize="22" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, thá»‘ng kÃª há»‡ thá»‘ng" FontSize="13" Foreground="White" Opacity="0.8"/>
                </StackPanel>
                <Button Content="ðŸ”„ LÃ m má»›i" Click="Refresh_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Foreground="White" DockPanel.Dock="Right" HorizontalAlignment="Right"
                        VerticalAlignment="Center"/>
            </DockPanel>
        </Border>

        <!-- Stats Cards -->
        <UniformGrid Grid.Row="1" Columns="5" Margin="16,12,16,0">
            <Border Background="#E3F2FD" CornerRadius="8" Padding="14" Margin="0,0,6,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ‘¥ Tá»•ng users" FontSize="11" TextAlignment="Center" Opacity="0.7"/>
                    <TextBlock x:Name="txtTotalUsers" Text="0" FontSize="24" FontWeight="Bold" 
                              TextAlignment="Center" Foreground="#1565C0"/>
                </StackPanel>
            </Border>
            <Border Background="#E8F5E9" CornerRadius="8" Padding="14" Margin="3,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="âœ… Active" FontSize="11" TextAlignment="Center" Opacity="0.7"/>
                    <TextBlock x:Name="txtActiveUsers" Text="0" FontSize="24" FontWeight="Bold" 
                              TextAlignment="Center" Foreground="#2E7D32"/>
                </StackPanel>
            </Border>
            <Border Background="#FFF3E0" CornerRadius="8" Padding="14" Margin="3,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ“¡ Requests hÃ´m nay" FontSize="11" TextAlignment="Center" Opacity="0.7"/>
                    <TextBlock x:Name="txtRequestsToday" Text="0" FontSize="24" FontWeight="Bold" 
                              TextAlignment="Center" Foreground="#E65100"/>
                </StackPanel>
            </Border>
            <Border Background="#F3E5F5" CornerRadius="8" Padding="14" Margin="3,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ“Š Requests thÃ¡ng" FontSize="11" TextAlignment="Center" Opacity="0.7"/>
                    <TextBlock x:Name="txtRequestsMonth" Text="0" FontSize="24" FontWeight="Bold" 
                              TextAlignment="Center" Foreground="#7B1FA2"/>
                </StackPanel>
            </Border>
            <Border Background="#FFEBEE" CornerRadius="8" Padding="14" Margin="6,0,0,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ’° Chi phÃ­ thÃ¡ng" FontSize="11" TextAlignment="Center" Opacity="0.7"/>
                    <TextBlock x:Name="txtCostMonth" Text="0 â‚«" FontSize="24" FontWeight="Bold" 
                              TextAlignment="Center" Foreground="#C62828"/>
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- Users Table -->
        <Grid Grid.Row="2" Margin="16,12,16,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" Margin="0,0,0,8">
                <TextBlock Text="ðŸ‘¥ Danh sÃ¡ch ngÆ°á»i dÃ¹ng" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                    <TextBox x:Name="txtSearch" Width="200"
                             materialDesign:HintAssist.Hint="ðŸ” TÃ¬m kiáº¿m..."
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Height="36" FontSize="12" Padding="8,6"
                             TextChanged="SearchChanged"/>
                    <Button Content="âž• ThÃªm user" Click="AddUser_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Height="36" Margin="8,0,0,0" FontSize="12"/>
                </StackPanel>
            </DockPanel>

            <DataGrid x:Name="dgUsers" Grid.Row="1" AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      materialDesign:DataGridAssist.CellPadding="10 6"
                      CanUserResizeColumns="True" CanUserSortColumns="True"
                      SelectionMode="Single" SelectionUnit="FullRow"
                      MouseDoubleClick="UserRow_DoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Há» tÃªn" Binding="{Binding FullName}" Width="150"/>
                    <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="180"/>
                    <DataGridTextColumn Header="GÃ³i" Binding="{Binding Plan}" Width="90"/>
                    <DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="70"/>
                    <DataGridTemplateColumn Header="Active" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ActiveIcon}" FontSize="16" HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Requests" Binding="{Binding RequestsUsed}" Width="80"/>
                    <DataGridTextColumn Header="Tokens" Binding="{Binding TokensUsed, StringFormat=N0}" Width="90"/>
                    <DataGridTextColumn Header="ÄÄƒng kÃ½" Binding="{Binding CreatedDate}" Width="100"/>
                    <DataGridTextColumn Header="Login cuá»‘i" Binding="{Binding LastLogin}" Width="100"/>
                    <DataGridTemplateColumn Header="Thao tÃ¡c" Width="160">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="âœï¸" ToolTip="Sá»­a" Click="EditUser_Click" Tag="{Binding UserId}"
                                            Style="{StaticResource MaterialDesignFlatButton}" Height="28" Width="36" Padding="0"/>
                                    <Button Content="ðŸ”„" ToolTip="Reset key" Click="ResetKey_Click" Tag="{Binding UserId}"
                                            Style="{StaticResource MaterialDesignFlatButton}" Height="28" Width="36" Padding="0"/>
                                    <Button Content="ðŸš«" ToolTip="KhÃ³a/Má»Ÿ" Click="ToggleActive_Click" Tag="{Binding UserId}"
                                            Style="{StaticResource MaterialDesignFlatButton}" Height="28" Width="36" Padding="0"/>
                                    <Button Content="ðŸ—‘ï¸" ToolTip="XÃ³a" Click="DeleteUser_Click" Tag="{Binding UserId}"
                                            Style="{StaticResource MaterialDesignFlatButton}" Height="28" Width="36" Padding="0"
                                            Foreground="Red"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- Loading overlay -->
        <Border x:Name="loadingOverlay" Grid.RowSpan="3" Background="#80FFFFFF" Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="Äang táº£i dá»¯ liá»‡u..." FontSize="14" Margin="0,12,0,0" TextAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>
