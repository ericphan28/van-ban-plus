<Window x:Class="AIVanBan.Desktop.Views.TemplateStoreDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="ðŸ“¦ Kho máº«u vÄƒn báº£n Online" 
        Width="950" Height="680"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource MaterialDesignWindow}"
        Loaded="Window_Loaded">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- â•â•â• HEADER â•â•â• -->
        <Border Grid.Row="0" Background="#1565C0" Padding="24,18">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸ“¦ KHO MáºªU VÄ‚N Báº¢N ONLINE" 
                               FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Táº£i máº«u vÄƒn báº£n má»›i tá»« VanBanPlus mÃ  khÃ´ng cáº§n cáº­p nháº­t pháº§n má»m"
                               FontSize="13" Foreground="#B3E5FC" Margin="0,4,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="btnDownloadAll" 
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#43A047" Foreground="White"
                            Click="DownloadAll_Click" Margin="0,0,10,0"
                            ToolTip="Táº£i táº¥t cáº£ máº«u má»›i/cáº§n cáº­p nháº­t">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CloudDownload" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock x:Name="txtDownloadAllLabel" Text="Táº£i táº¥t cáº£ má»›i" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#1976D2" Foreground="White"
                            Click="Refresh_Click"
                            ToolTip="LÃ m má»›i danh sÃ¡ch">
                        <materialDesign:PackIcon Kind="Refresh"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â• FILTER BAR â•â•â• -->
        <Border Grid.Row="1" Background="#F5F5F5" Padding="16,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBox x:Name="txtSearch" Grid.Column="0"
                         materialDesign:HintAssist.Hint="ðŸ” TÃ¬m kiáº¿m máº«u..."
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Height="38" Margin="0,0,12,0"
                         KeyUp="Search_KeyUp"/>
                
                <ComboBox x:Name="cboCategory" Grid.Column="1"
                          materialDesign:HintAssist.Hint="LÄ©nh vá»±c"
                          Width="160" Height="38" Margin="0,0,12,0"
                          SelectionChanged="Filter_Changed"/>
                
                <ComboBox x:Name="cboStatus" Grid.Column="2"
                          materialDesign:HintAssist.Hint="Tráº¡ng thÃ¡i"
                          Width="140" Height="38"
                          SelectionChanged="Filter_Changed">
                    <ComboBoxItem Content="Táº¥t cáº£" IsSelected="True"/>
                    <ComboBoxItem Content="ChÆ°a táº£i"/>
                    <ComboBoxItem Content="ÄÃ£ cÃ³"/>
                    <ComboBoxItem Content="Cáº§n cáº­p nháº­t"/>
                </ComboBox>
            </Grid>
        </Border>

        <!-- â•â•â• MAIN CONTENT â•â•â• -->
        <!-- Loading -->
        <StackPanel x:Name="pnlLoading" Grid.Row="2" 
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    Visibility="Collapsed">
            <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                         IsIndeterminate="True" Width="48" Height="48"/>
            <TextBlock x:Name="txtLoadingMsg" Text="Äang táº£i kho máº«u..." 
                       FontSize="14" Margin="0,12,0,0" HorizontalAlignment="Center"
                       Foreground="#757575"/>
        </StackPanel>
        
        <!-- Error -->
        <Border x:Name="pnlError" Grid.Row="2" Visibility="Collapsed"
                Margin="30" Padding="24" CornerRadius="12" 
                HorizontalAlignment="Center" VerticalAlignment="Center">
            <Border.Background>
                <SolidColorBrush Color="#FFF3E0"/>
            </Border.Background>
            <StackPanel HorizontalAlignment="Center" MaxWidth="450">
                <TextBlock Text="âš ï¸" FontSize="40" HorizontalAlignment="Center"/>
                <TextBlock x:Name="txtError" Text="KhÃ´ng thá»ƒ káº¿t ná»‘i kho máº«u"
                           FontSize="15" TextWrapping="Wrap" TextAlignment="Center"
                           Margin="0,8,0,12"/>
                <Button Content="ðŸ”„ Thá»­ láº¡i" Click="Refresh_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- Template List -->
        <ScrollViewer x:Name="pnlResults" Grid.Row="2" 
                      VerticalScrollBarVisibility="Auto" Visibility="Collapsed">
            <ItemsControl x:Name="lstTemplates" Margin="16,8,16,16">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <materialDesign:Card Margin="0,0,0,10" Padding="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="6"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Color indicator -->
                                <Border Grid.Column="0" CornerRadius="3,0,0,3">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#1976D2"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="UpToDate">
                                                    <Setter Property="Background" Value="#4CAF50"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="UpdateAvailable">
                                                    <Setter Property="Background" Value="#FF9800"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                                
                                <!-- Content -->
                                <StackPanel Grid.Column="1" Margin="16,12">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                        <TextBlock Text="{Binding Template.Name}" 
                                                   FontSize="15" FontWeight="SemiBold"
                                                   Foreground="#212121"/>
                                        
                                        <!-- Badge: Má»šI -->
                                        <Border Margin="8,0,0,0" Padding="6,2" CornerRadius="4"
                                                Background="#E8F5E9">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Template.IsNew}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="ðŸ†• Má»šI" FontSize="11" Foreground="#2E7D32"/>
                                        </Border>
                                        
                                        <!-- Badge: PHá»” BIáº¾N -->
                                        <Border Margin="8,0,0,0" Padding="6,2" CornerRadius="4"
                                                Background="#FFF8E1">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding Template.IsPopular}" Value="True"/>
                                                                <Condition Binding="{Binding Template.IsNew}" Value="False"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="â­ PHá»” BIáº¾N" FontSize="11" Foreground="#F57F17"/>
                                        </Border>
                                    </StackPanel>
                                    
                                    <TextBlock Text="{Binding Template.Description}" 
                                               FontSize="12.5" Foreground="#616161"
                                               TextWrapping="Wrap" MaxWidth="550"/>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                        <Border Background="#E3F2FD" Padding="6,2" CornerRadius="3" Margin="0,0,6,0">
                                            <TextBlock Text="{Binding TypeDisplay}" FontSize="11" Foreground="#1565C0"/>
                                        </Border>
                                        <Border Background="#F3E5F5" Padding="6,2" CornerRadius="3" Margin="0,0,6,0">
                                            <TextBlock Text="{Binding CategoryDisplay}" FontSize="11" Foreground="#7B1FA2"/>
                                        </Border>
                                        <TextBlock Text="{Binding VersionDisplay}" FontSize="11" Foreground="#9E9E9E"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>
                                
                                <!-- Action button -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="12" 
                                            MinWidth="110" HorizontalAlignment="Right">
                                    <Button Click="DownloadOne_Click" 
                                            Tag="{Binding Template.StoreId}"
                                            HorizontalAlignment="Stretch"
                                            Height="36">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                <Setter Property="Background" Value="#1976D2"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="IsEnabled" Value="True"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Status}" Value="UpToDate">
                                                        <Setter Property="Background" Value="#E8F5E9"/>
                                                        <Setter Property="Foreground" Value="#4CAF50"/>
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Status}" Value="UpdateAvailable">
                                                        <Setter Property="Background" Value="#FF9800"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon VerticalAlignment="Center" Margin="0,0,4,0">
                                                <materialDesign:PackIcon.Style>
                                                    <Style TargetType="materialDesign:PackIcon">
                                                        <Setter Property="Kind" Value="CloudDownload"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="UpToDate">
                                                                <Setter Property="Kind" Value="Check"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="UpdateAvailable">
                                                                <Setter Property="Kind" Value="Update"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </materialDesign:PackIcon.Style>
                                            </materialDesign:PackIcon>
                                            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- â•â•â• FOOTER â•â•â• -->
        <Border Grid.Row="3" Background="#FAFAFA" Padding="16,10"
                BorderThickness="0,1,0,0" BorderBrush="#E0E0E0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="txtFooter" Grid.Column="0"
                           Text="Äang táº£i..." FontSize="12.5" Foreground="#757575"
                           VerticalAlignment="Center"/>
                
                <Button Grid.Column="1" Content="ÄÃ³ng" Click="Close_Click"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        FontSize="13"/>
            </Grid>
        </Border>
    </Grid>
</Window>
