<Page x:Class="AIVanBan.Desktop.Views.PhotoAlbumPageSimple"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:local="clr-namespace:AIVanBan.Desktop.Views"
    Background="#F5F5F5"
    Title="Quáº£n lÃ½ Album áº£nh"
    Focusable="True"
    KeyDown="PhotoAlbumPage_KeyDown">

    <Page.Resources>
        <!-- Null to Collapsed converter for EventDate -->
        <local:NullToVisibilityConverter x:Key="NullToCollapsedConverter"/>
        
        <!-- Grid View Panel -->
        <ItemsPanelTemplate x:Key="GridViewPanel">
            <WrapPanel Orientation="Horizontal"/>
        </ItemsPanelTemplate>

        <!-- List View Panel -->
        <ItemsPanelTemplate x:Key="ListViewPanel">
            <StackPanel Orientation="Vertical"/>
        </ItemsPanelTemplate>

        <!-- Cards View Panel -->
        <ItemsPanelTemplate x:Key="CardsViewPanel">
            <StackPanel Orientation="Vertical"/>
        </ItemsPanelTemplate>

        <!-- Grid View Template (large 300x300 cards with 2x2 thumbnails) -->
        <DataTemplate x:Key="GridViewTemplate">
            <materialDesign:Card Width="300" Margin="10" 
                               MouseLeftButtonDown="AlbumCard_Select"
                               MouseEnter="AlbumCard_MouseEnter"
                               MouseLeave="AlbumCard_MouseLeave"
                               Tag="{Binding Id}"
                               materialDesign:ElevationAssist.Elevation="Dp2">
                <materialDesign:Card.Style>
                    <Style TargetType="materialDesign:Card">
                        <Setter Property="Cursor" Value="Hand"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp8"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </materialDesign:Card.Style>
                <materialDesign:Card.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="ðŸ“‚ Má»Ÿ album" Click="OpenAlbum_Click" FontWeight="Bold"/>
                        <MenuItem Header="ï¿½ï¸ ThÃªm áº£nh" Click="AddPhotosToAlbum_Click" FontWeight="Bold"/>
                        <MenuItem Header="ðŸ—‚ï¸ Má»Ÿ thÆ° má»¥c" Click="OpenAlbumFolder_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“ Di chuyá»ƒn Ä‘áº¿n thÆ° má»¥c..." Click="MoveAlbumToFolder_Click"/>
                        <MenuItem Header="âœï¸ Chá»‰nh sá»­a" Click="EditAlbumFromMenu_Click"/>
                        <MenuItem Header="âœï¸ Äá»•i tÃªn" Click="RenameAlbum_Click"/>
                        <MenuItem Header="ðŸ“‹ Copy Ä‘Æ°á»ng dáº«n" Click="CopyAlbumPath_Click"/>
                        <MenuItem Header="ðŸ“¤ Export album" Click="ExportAlbum_Click"/>
                        <MenuItem Header="ðŸ“‘ NhÃ¢n báº£n album" Click="DuplicateAlbum_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ—‘ï¸ XÃ³a album" Click="DeleteAlbumFromMenu_Click" Foreground="Red"/>
                    </ContextMenu>
                </materialDesign:Card.ContextMenu>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="220"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Selected Border - pháº£i á»Ÿ trÃªn cÃ¹ng vÃ  span cáº£ 2 rows -->
                    <Border x:Name="selectedBorder"
                            Grid.RowSpan="2"
                            BorderBrush="#2196F3"
                            Background="#202196F3"
                            BorderThickness="4"
                            CornerRadius="4"
                            Visibility="Collapsed"
                            Panel.ZIndex="10"/>

                    <!-- Cover Photo vá»›i gradient overlay -->
                    <Border Grid.Row="0" Background="#F5F5F5" CornerRadius="4,4,0,0" ClipToBounds="True">
                        <Grid>
                            <!-- Thumbnail Grid (2x2) -->
                            <Grid x:Name="thumbnailGrid" Visibility="Collapsed">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Image x:Name="thumb1" Grid.Row="0" Grid.Column="0" Stretch="UniformToFill" Margin="0,0,1,1"/>
                                <Image x:Name="thumb2" Grid.Row="0" Grid.Column="1" Stretch="UniformToFill" Margin="1,0,0,1"/>
                                <Image x:Name="thumb3" Grid.Row="1" Grid.Column="0" Stretch="UniformToFill" Margin="0,1,1,0"/>
                                <Image x:Name="thumb4" Grid.Row="1" Grid.Column="1" Stretch="UniformToFill" Margin="1,1,0,0"/>
                            </Grid>

                            <!-- Placeholder (when no photos) -->
                            <StackPanel x:Name="emptyPlaceholder" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <materialDesign:PackIcon Kind="ImageMultiple" 
                                                       Width="60" Height="60" 
                                                       Foreground="#BDBDBD"/>
                                <TextBlock Text="ChÆ°a cÃ³ áº£nh" 
                                           FontSize="12" 
                                           Foreground="#999"
                                           Margin="0,8,0,0"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Gradient overlay bottom -->
                            <Border VerticalAlignment="Bottom" Height="60">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="Transparent" Offset="0"/>
                                        <GradientStop Color="#AA000000" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                            
                            <!-- Photo count badge -->
                            <Border Background="#2196F3" 
                                    CornerRadius="12"
                                    Padding="10,5"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,12,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Image" Width="16" Height="16" Foreground="White" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding PhotoCount}" 
                                               FontSize="13" 
                                               FontWeight="Bold"
                                               Foreground="White"
                                               Margin="5,0,0,0"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Hover overlay with quick actions -->
                            <Border x:Name="hoverOverlay"
                                    Background="#DD2196F3"
                                    Opacity="0">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=materialDesign:Card}}" Value="True">
                                                <Setter Property="Opacity" Value="1"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <materialDesign:PackIcon Kind="Eye" 
                                                           Width="48" 
                                                           Height="48" 
                                                           Foreground="White"/>
                                    <TextBlock Text="Double-click Ä‘á»ƒ má»Ÿ" 
                                               Foreground="White" 
                                               FontSize="15"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Center"
                                               Margin="0,10,0,0"/>
                                    <TextBlock Text="Right-click cho thÃªm tÃ¹y chá»n" 
                                               Foreground="#EEEEEE" 
                                               FontSize="11"
                                               HorizontalAlignment="Center"
                                               Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Album Info -->
                    <Grid Grid.Row="1" Margin="15">
                        <StackPanel>
                            <TextBlock Text="{Binding Title}" 
                                       FontSize="16" 
                                       FontWeight="Bold" 
                                       TextTrimming="CharacterEllipsis"
                                       Margin="0,0,0,6"/>
                            
                            <TextBlock Text="{Binding Description}" 
                                       FontSize="12" 
                                       Foreground="#666" 
                                       TextTrimming="CharacterEllipsis"
                                       MaxHeight="36"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,10"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Date -->
                                <StackPanel Orientation="Horizontal" Grid.Column="0">
                                    <materialDesign:PackIcon Kind="CalendarOutline" Width="14" Height="14" Foreground="#999" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CreatedDate, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                               FontSize="11" 
                                               Foreground="#999" 
                                               Margin="5,0,0,0" 
                                               VerticalAlignment="Center"/>
                                    <!-- Event Date badge -->
                                    <Border Background="#E3F2FD" CornerRadius="8" Padding="6,2" Margin="10,0,0,0"
                                            Visibility="{Binding EventDate, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="CalendarStar" Width="12" Height="12" Foreground="#1565C0" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding EventDate, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                       FontSize="10" Foreground="#1565C0" FontWeight="SemiBold"
                                                       Margin="4,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>

                            <!-- Tags -->
                            <ItemsControl ItemsSource="{Binding Tags}" Margin="0,10,0,0">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#E8F5E9" 
                                                CornerRadius="10" 
                                                Margin="0,0,5,5"
                                                Padding="8,3">
                                            <TextBlock Text="{Binding}" 
                                                       FontSize="10" 
                                                       Foreground="#2E7D32"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                </Grid>
            </materialDesign:Card>
        </DataTemplate>

        <!-- Cards View Template (medium horizontal card) -->
        <DataTemplate x:Key="CardsViewTemplate">
            <materialDesign:Card Margin="10,8" Padding="0"
                               MouseLeftButtonDown="AlbumCard_Select"
                               MouseEnter="AlbumCard_MouseEnter"
                               MouseLeave="AlbumCard_MouseLeave"
                               Tag="{Binding Id}"
                               materialDesign:ElevationAssist.Elevation="Dp2">
                <materialDesign:Card.Style>
                    <Style TargetType="materialDesign:Card">
                        <Setter Property="Cursor" Value="Hand"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp6"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </materialDesign:Card.Style>
                <materialDesign:Card.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="ðŸ“‚ Má»Ÿ album" Click="OpenAlbum_Click" FontWeight="Bold"/>
                        <MenuItem Header="ðŸ—‚ï¸ Má»Ÿ thÆ° má»¥c" Click="OpenAlbumFolder_Click"/>
                        <MenuItem Header="âœï¸ Chá»‰nh sá»­a" Click="EditAlbumFromMenu_Click"/>
                        <MenuItem Header="âœï¸ Äá»•i tÃªn" Click="RenameAlbum_Click"/>
                        <MenuItem Header="ðŸ“‹ Copy Ä‘Æ°á»ng dáº«n" Click="CopyAlbumPath_Click"/>
                        <MenuItem Header="ðŸ“¤ Export album" Click="ExportAlbum_Click"/>
                        <MenuItem Header="ðŸ“‘ NhÃ¢n báº£n album" Click="DuplicateAlbum_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ—‘ï¸ XÃ³a album" Click="DeleteAlbumFromMenu_Click" Foreground="Red"/>
                    </ContextMenu>
                </materialDesign:Card.ContextMenu>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Selected Border -->
                    <Border x:Name="selectedBorder"
                            Grid.ColumnSpan="2"
                            BorderBrush="#2196F3"
                            Background="#202196F3"
                            BorderThickness="4"
                            CornerRadius="4"
                            Visibility="Collapsed"
                            Panel.ZIndex="10"/>

                    <!-- Thumbnail Preview (medium 2x2 grid) -->
                    <Border Grid.Column="0" Height="140" Background="#F5F5F5" CornerRadius="8,0,0,8" ClipToBounds="True">
                        <Grid>
                            <Grid x:Name="thumbnailGrid" Visibility="Collapsed">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Image x:Name="thumb1" Grid.Row="0" Grid.Column="0" Stretch="UniformToFill" Margin="0,0,0.5,0.5"/>
                                <Image x:Name="thumb2" Grid.Row="0" Grid.Column="1" Stretch="UniformToFill" Margin="0.5,0,0,0.5"/>
                                <Image x:Name="thumb3" Grid.Row="1" Grid.Column="0" Stretch="UniformToFill" Margin="0,0.5,0.5,0"/>
                                <Image x:Name="thumb4" Grid.Row="1" Grid.Column="1" Stretch="UniformToFill" Margin="0.5,0.5,0,0"/>
                            </Grid>
                            <StackPanel x:Name="emptyPlaceholder" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <materialDesign:PackIcon Kind="ImageMultiple" Width="50" Height="50" Foreground="#BDBDBD"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Album Info -->
                    <Grid Grid.Column="1" Margin="20,15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="{Binding Title}" 
                                   FontSize="18" 
                                   FontWeight="Bold" 
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Grid.Row="1" Text="{Binding Description}" 
                                   FontSize="13" 
                                   Foreground="#666" 
                                   TextWrapping="Wrap"
                                   MaxHeight="40"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="0,6,0,0"/>
                        
                        <StackPanel Grid.Row="3" Orientation="Horizontal">
                            <Border Background="#E3F2FD" CornerRadius="12" Padding="10,5" Margin="0,0,10,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Image" Width="16" Height="16" Foreground="#2196F3" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding PhotoCount}" FontSize="13" FontWeight="SemiBold" Foreground="#2196F3" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                    <TextBlock Text=" áº£nh" FontSize="13" Foreground="#2196F3" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <materialDesign:PackIcon Kind="CalendarOutline" Width="16" Height="16" Foreground="#999" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding CreatedDate, StringFormat='{}{0:dd/MM/yyyy}'}" FontSize="12" Foreground="#999" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                            <!-- Event Date badge -->
                            <Border Background="#E3F2FD" CornerRadius="8" Padding="6,2" Margin="10,0,0,0"
                                    Visibility="{Binding EventDate, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="CalendarStar" Width="12" Height="12" Foreground="#1565C0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding EventDate, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                               FontSize="10" Foreground="#1565C0" FontWeight="SemiBold"
                                               Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Grid>
            </materialDesign:Card>
        </DataTemplate>

        <!-- List View Template (horizontal layout) -->
        <DataTemplate x:Key="ListViewTemplate">
            <materialDesign:Card Margin="10,5" Padding="15"
                               MouseLeftButtonDown="AlbumCard_Select"
                               MouseEnter="AlbumCard_MouseEnter"
                               MouseLeave="AlbumCard_MouseLeave"
                               Tag="{Binding Id}"
                               materialDesign:ElevationAssist.Elevation="Dp1">
                <materialDesign:Card.Style>
                    <Style TargetType="materialDesign:Card">
                        <Setter Property="Cursor" Value="Hand"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp4"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </materialDesign:Card.Style>
                <materialDesign:Card.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="ðŸ“‚ Má»Ÿ album" Click="OpenAlbum_Click" FontWeight="Bold"/>
                        <MenuItem Header="ðŸ—‚ï¸ Má»Ÿ thÆ° má»¥c" Click="OpenAlbumFolder_Click"/>
                        <MenuItem Header="âœï¸ Chá»‰nh sá»­a" Click="EditAlbumFromMenu_Click"/>
                        <MenuItem Header="âœï¸ Äá»•i tÃªn" Click="RenameAlbum_Click"/>
                        <MenuItem Header="ðŸ“‹ Copy Ä‘Æ°á»ng dáº«n" Click="CopyAlbumPath_Click"/>
                        <MenuItem Header="ðŸ“¤ Export album" Click="ExportAlbum_Click"/>
                        <MenuItem Header="ðŸ“‘ NhÃ¢n báº£n album" Click="DuplicateAlbum_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ—‘ï¸ XÃ³a album" Click="DeleteAlbumFromMenu_Click" Foreground="Red"/>
                    </ContextMenu>
                </materialDesign:Card.ContextMenu>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Selected Border -->
                    <Border x:Name="selectedBorder"
                            Grid.ColumnSpan="3"
                            BorderBrush="#2196F3"
                            Background="#202196F3"
                            BorderThickness="4"
                            CornerRadius="4"
                            Visibility="Collapsed"
                            Panel.ZIndex="10"/>

                    <!-- Thumbnail Preview (small 4-grid) -->
                    <Border Grid.Column="0" Width="100" Height="100" Background="#F5F5F5" CornerRadius="4" ClipToBounds="True">
                        <Grid>
                            <Grid x:Name="thumbnailGrid" Visibility="Collapsed">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Image x:Name="thumb1" Grid.Row="0" Grid.Column="0" Stretch="UniformToFill" Margin="0,0,0.5,0.5"/>
                                <Image x:Name="thumb2" Grid.Row="0" Grid.Column="1" Stretch="UniformToFill" Margin="0.5,0,0,0.5"/>
                                <Image x:Name="thumb3" Grid.Row="1" Grid.Column="0" Stretch="UniformToFill" Margin="0,0.5,0.5,0"/>
                                <Image x:Name="thumb4" Grid.Row="1" Grid.Column="1" Stretch="UniformToFill" Margin="0.5,0.5,0,0"/>
                            </Grid>
                            <StackPanel x:Name="emptyPlaceholder" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <materialDesign:PackIcon Kind="ImageMultiple" Width="40" Height="40" Foreground="#BDBDBD"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Album Info -->
                    <StackPanel Grid.Column="1" Margin="15,0,15,0" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Title}" 
                                   FontSize="16" 
                                   FontWeight="Bold" 
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding Description}" 
                                   FontSize="12" 
                                   Foreground="#666" 
                                   TextTrimming="CharacterEllipsis"
                                   Margin="0,4,0,8"/>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Image" Width="14" Height="14" Foreground="#2196F3" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding PhotoCount}" FontSize="12" Foreground="#666" Margin="5,0,15,0" VerticalAlignment="Center"/>
                            <materialDesign:PackIcon Kind="CalendarOutline" Width="14" Height="14" Foreground="#999" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding CreatedDate, StringFormat='{}{0:dd/MM/yyyy}'}" FontSize="11" Foreground="#999" Margin="5,0,0,0" VerticalAlignment="Center"/>
                            <!-- Event Date badge -->
                            <Border Background="#E3F2FD" CornerRadius="8" Padding="6,2" Margin="10,0,0,0"
                                    Visibility="{Binding EventDate, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="CalendarStar" Width="12" Height="12" Foreground="#1565C0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding EventDate, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                               FontSize="10" Foreground="#1565C0" FontWeight="SemiBold"
                                               Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>

                    <!-- Actions -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="ChevronRight" Width="24" Height="24" Foreground="#999"/>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>  <!-- Folder Tree -->
            <ColumnDefinition Width="*"/>    <!-- Album Grid -->
        </Grid.ColumnDefinitions>

        <!-- Left: Folder Tree -->
        <Border Grid.Column="0" Background="White" 
                BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
            <DockPanel>
                <!-- Folder Tree Header -->
                <Border DockPanel.Dock="Top" Background="#F5F5F5" 
                        Padding="16,12" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                    <TextBlock Text="ðŸ“ THÆ¯ Má»¤C" 
                               FontSize="14" FontWeight="Bold" Foreground="#333"/>
                </Border>
                
                <!-- Folder Actions -->
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" 
                            Margin="8" Background="White">
                    <Button x:Name="btnExpandAll" 
                           Style="{StaticResource MaterialDesignIconButton}"
                           ToolTip="Má»Ÿ rá»™ng táº¥t cáº£"
                           Click="ExpandAll_Click"
                           Width="28" Height="28">
                        <materialDesign:PackIcon Kind="UnfoldMoreHorizontal" Width="16" Height="16"/>
                    </Button>
                    <Button x:Name="btnCollapseAll"
                           Style="{StaticResource MaterialDesignIconButton}"
                           ToolTip="Thu gá»n táº¥t cáº£"
                           Click="CollapseAll_Click"
                           Width="28" Height="28"
                           Margin="4,0,0,0">
                        <materialDesign:PackIcon Kind="UnfoldLessHorizontal" Width="16" Height="16"/>
                    </Button>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" 
                               Margin="4,0"/>
                    <Button x:Name="btnNewFolder" Content="ðŸ“"
                            ToolTip="Táº¡o thÆ° má»¥c má»›i"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Width="32" Height="32"
                            Click="CreateFolder_Click"/>
                    <Button x:Name="btnRefreshFolders" Content="ðŸ”„"
                            ToolTip="LÃ m má»›i danh sÃ¡ch"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Width="32" Height="32"
                            Click="RefreshFolders_Click"
                            Margin="4,0,0,0"/>
                </StackPanel>
                
                <!-- TreeView -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TreeView x:Name="folderTree"
                              SelectedItemChanged="FolderTree_SelectionChanged"
                              Background="Transparent"
                              BorderThickness="0"
                              Margin="8">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.Resources>
                            <HierarchicalDataTemplate DataType="{x:Type local:FolderTreeItem}" 
                                                      ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal" 
                                            MouseRightButtonDown="FolderTreeItem_RightClick"
                                            Tag="{Binding}">
                                    <StackPanel.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="ðŸ“‚ Má»Ÿ thÆ° má»¥c" Click="OpenFolderMenu_Click"/>
                                            <Separator/>
                                            <MenuItem Header="ðŸ“¸ Táº¡o Album áº£nh" Click="CreateAlbumInFolder_Click" FontWeight="Bold"/>
                                            <MenuItem Header="ðŸ“ ThÆ° má»¥c con má»›i" Click="CreateSubFolder_Click"/>
                                            <Separator/>
                                            <MenuItem Header="âœï¸ Äá»•i tÃªn" Click="RenameFolder_Click"/>
                                            <MenuItem Header="ðŸ—‘ï¸ XÃ³a thÆ° má»¥c" Click="DeleteFolder_Click" Foreground="Red"/>
                                        </ContextMenu>
                                    </StackPanel.ContextMenu>
                                    
                                    <TextBlock Text="{Binding Icon}" Margin="0,0,6,0" FontSize="14"/>
                                    <TextBlock Text="{Binding Name}" FontSize="13" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding AlbumCount, StringFormat=' ({0})'}" 
                                               Foreground="#999" FontSize="11" 
                                               Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.Resources>
                    </TreeView>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- Right: Album Grid Area -->
        <Grid Grid.Column="1">
            <!-- Album List View (folder content) -->
            <Grid x:Name="albumListView">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <materialDesign:Card Grid.Row="0" Margin="10" Padding="20" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <materialDesign:PackIcon Kind="ImageMultiple" Width="36" Height="36" Foreground="#2196F3" VerticalAlignment="Center"/>
                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                        <TextBlock Text="Quáº£n lÃ½ Album áº£nh" 
                                   FontSize="22" 
                                   FontWeight="Bold"/>
                        <TextBlock x:Name="txtSubtitle" Text="Tá»• chá»©c vÃ  quáº£n lÃ½ áº£nh cá»§a báº¡n" 
                                   FontSize="13" 
                                   Foreground="#666"
                                   Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="btnCreateSubFolder"
                            Content="ðŸ“ ThÆ° má»¥c con"
                            Click="CreateSubFolderFromHeader_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#2196F3"
                            BorderBrush="#2196F3"
                            Height="40"
                            Padding="16,0"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Margin="0,0,10,0"/>
                    <Button Content="ðŸ“¸ Táº¡o Album"
                            Click="CreateAlbum_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#4CAF50"
                            BorderBrush="#4CAF50"
                            Height="40"
                            Padding="16,0"
                            FontSize="13"
                            FontWeight="SemiBold"/>
                    <Button Click="DownloadFromWeb_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#1565C0"
                            BorderBrush="#1565C0"
                            Height="40"
                            Padding="16,0"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Margin="10,0,0,0"
                            ToolTip="Táº£i album tá»« website xÃ£ Gia Kiá»‡m (xagiakiem.gov.vn)">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CloudDownload" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Táº£i tá»« Website" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="UploadToWeb_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#E65100"
                            BorderBrush="#E65100"
                            Height="40"
                            Padding="16,0"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Margin="10,0,0,0"
                            ToolTip="Upload album lÃªn website xÃ£ Gia Kiá»‡m (xagiakiem.gov.vn)">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CloudUpload" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Upload lÃªn Web" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Toolbar: Search & Filters -->
        <materialDesign:Card Grid.Row="1" Margin="10,0,10,10" Padding="15" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="txtSearch"
                         Width="400"
                         HorizontalAlignment="Left"
                         materialDesign:HintAssist.Hint="ðŸ” TÃ¬m kiáº¿m album theo tÃªn, mÃ´ táº£, tags..."
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         TextChanged="Search_TextChanged"
                         VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <ComboBox x:Name="cboSort" 
                              Width="150"
                              materialDesign:HintAssist.Hint="Sáº¯p xáº¿p"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              SelectionChanged="Sort_SelectionChanged"
                              Margin="0,0,10,0">
                        <ComboBoxItem Content="Má»›i nháº¥t" IsSelected="True"/>
                        <ComboBoxItem Content="CÅ© nháº¥t"/>
                        <ComboBoxItem Content="TÃªn A-Z"/>
                        <ComboBoxItem Content="TÃªn Z-A"/>
                        <ComboBoxItem Content="Nhiá»u áº£nh nháº¥t"/>
                    </ComboBox>
                    
                    <Button x:Name="btnViewMode" 
                            Style="{StaticResource MaterialDesignIconButton}"
                            ToolTip="Cháº¿ Ä‘á»™ xem: Grid"
                            Width="40" Height="40"
                            Click="ViewMode_Click">
                        <materialDesign:PackIcon x:Name="iconViewMode" Kind="ViewGrid" Width="24" Height="24"/>
                    </Button>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Album Grid -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Stats Bar -->
                <Border Grid.Row="0" 
                        Background="White" 
                        CornerRadius="8" 
                        Padding="15,10" 
                        Margin="0,0,0,15"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Folder" Width="20" Height="20" Foreground="#FF9800" VerticalAlignment="Center"/>
                        <TextBlock x:Name="txtFolderCount" Text="0 thÆ° má»¥c" FontSize="14" FontWeight="SemiBold" Foreground="#333" Margin="8,0,30,0" VerticalAlignment="Center"/>

                        <materialDesign:PackIcon Kind="FolderMultipleImage" Width="20" Height="20" Foreground="#2196F3" VerticalAlignment="Center"/>
                        <TextBlock x:Name="txtAlbumCount" Text="0 albums" FontSize="14" FontWeight="SemiBold" Foreground="#333" Margin="8,0,30,0" VerticalAlignment="Center"/>
                        
                        <materialDesign:PackIcon Kind="Image" Width="20" Height="20" Foreground="#4CAF50" VerticalAlignment="Center"/>
                        <TextBlock x:Name="txtTotalPhotos" Text="0 áº£nh" FontSize="14" FontWeight="SemiBold" Foreground="#333" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Section: Child Folders Header -->
                <TextBlock x:Name="txtChildFoldersHeader" Grid.Row="1" 
                           Text="ðŸ“ ThÆ° má»¥c con" 
                           FontSize="15" FontWeight="Bold" Foreground="#555"
                           Margin="5,0,0,10" Visibility="Collapsed"/>

                <!-- Child Folders Panel -->
                <ItemsControl x:Name="childFoldersPanel" Grid.Row="2" Visibility="Collapsed" Margin="0,0,0,15">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <materialDesign:Card Width="200" Margin="5" Padding="0"
                                               MouseLeftButtonDown="ChildFolderCard_Click"
                                               Tag="{Binding Id}"
                                               Cursor="Hand"
                                               materialDesign:ElevationAssist.Elevation="Dp2">
                                <materialDesign:Card.Style>
                                    <Style TargetType="materialDesign:Card">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="materialDesign:ElevationAssist.Elevation" Value="Dp6"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </materialDesign:Card.Style>
                                <Grid Margin="15,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" Foreground="#333"/>
                                        <TextBlock Text="{Binding AlbumCount, StringFormat='{}{0} album'}" FontSize="11" Foreground="#999" Margin="0,2,0,0"/>
                                    </StackPanel>
                                    <materialDesign:PackIcon Grid.Column="2" Kind="ChevronRight" Width="20" Height="20" Foreground="#CCC" VerticalAlignment="Center"/>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Section: Albums Header -->
                <TextBlock x:Name="txtAlbumsHeader" Grid.Row="3" 
                           Text="ðŸ“¸ Album áº£nh" 
                           FontSize="15" FontWeight="Bold" Foreground="#555"
                           Margin="5,5,0,10" Visibility="Collapsed"/>

                <!-- Albums WrapPanel -->
                <ItemsControl x:Name="albumsPanel" Grid.Row="4" ItemTemplate="{StaticResource GridViewTemplate}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Empty state -->
                <StackPanel x:Name="emptyState" 
                           Grid.Row="4"
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center"
                           Visibility="Collapsed"
                           Margin="0,50,0,0">
                    <materialDesign:PackIcon Kind="FolderImage" Width="100" Height="100" Foreground="#E0E0E0"/>
                    <TextBlock x:Name="txtEmptyTitle" 
                               Text="ThÆ° má»¥c trá»‘ng" 
                               FontSize="22" 
                               FontWeight="Bold"
                               Foreground="#999" 
                               HorizontalAlignment="Center"
                               Margin="0,16,0,8"/>
                    <TextBlock x:Name="txtEmptyDesc" 
                               Text="Táº¡o thÆ° má»¥c con hoáº·c album áº£nh Ä‘á»ƒ báº¯t Ä‘áº§u" 
                               FontSize="13" 
                               Foreground="#BBB"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,25"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button x:Name="btnEmptyCreateFolder"
                                Content="ðŸ“ Táº¡o thÆ° má»¥c con"
                                Click="CreateSubFolderFromHeader_Click"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#2196F3"
                                BorderBrush="#2196F3"
                                Height="40"
                                Padding="20,0"
                                FontSize="13"
                                FontWeight="SemiBold"
                                Margin="0,0,12,0"/>
                        <Button Content="ðŸ“¸ Táº¡o Album áº£nh"
                                Click="CreateAlbum_Click"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#4CAF50"
                                BorderBrush="#4CAF50"
                                Height="40"
                                Padding="20,0"
                                FontSize="13"
                                FontWeight="SemiBold"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </ScrollViewer>
        </Grid>  <!-- End albumListView -->

            <!-- Album Detail View (embedded - folder tree stays visible) -->
            <Frame x:Name="albumDetailFrame" 
                   NavigationUIVisibility="Hidden" 
                   Visibility="Collapsed"/>
        </Grid>  <!-- End Right Column -->
    </Grid>  <!-- End Main Grid with 2 columns -->
</Page>
