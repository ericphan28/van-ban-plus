<Window x:Class="AIVanBan.Desktop.Views.PeriodicReportDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="üìä AI So·∫°n b√°o c√°o ƒë·ªãnh k·ª≥" 
        Height="780" 
        Width="1050"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        FontFamily="{DynamicResource MaterialDesignFont}">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="üìä AI So·∫°n b√°o c√°o ƒë·ªãnh k·ª≥" 
                      Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                      Margin="0,0,0,5"/>
            <TextBlock Text="Nh·∫≠p s·ªë li·ªáu th√¥ ‚Üí AI t·ª± t√≠nh to√°n, so s√°nh k·ª≥ tr∆∞·ªõc, vi·∫øt ƒë√°nh gi√° + ki·∫øn ngh·ªã"
                      Style="{StaticResource MaterialDesignBody2TextBlock}"
                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- Main Content: 2 columns -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Input Form -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- K·ªãch b·∫£n m·∫´u (demo) - ƒë·∫∑t tr√™n c√πng cho d·ªÖ th·∫•y -->
                    <materialDesign:Card Padding="16" Margin="0,0,0,12"
                                         Background="#FFF3E0">
                        <StackPanel>
                            <TextBlock Text="üéØ D·ªØ li·ªáu demo m·∫´u" 
                                      FontWeight="Bold" FontSize="14" 
                                      Foreground="#E65100"
                                      Margin="0,0,0,4"/>
                            <TextBlock Text="Ch·ªçn k·ªãch b·∫£n ‚Üí T·∫£i ‚Üí B·∫•m T·∫°o b√°o c√°o b√™n ph·∫£i"
                                      FontSize="12" Foreground="#BF360C"
                                      Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ComboBox x:Name="cboSampleScenario"
                                         materialDesign:HintAssist.Hint="Ch·ªçn k·ªãch b·∫£n"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         FontSize="12"/>
                                <Button Grid.Column="2"
                                       Style="{StaticResource MaterialDesignFlatMidBgButton}"
                                       Content="üìù T·∫£i demo"
                                       Click="LoadSample_Click"
                                       Padding="16,6"
                                       FontWeight="Bold"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <materialDesign:Card Padding="16" Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="üèõÔ∏è Th√¥ng tin c∆° b·∫£n" 
                                      FontWeight="SemiBold" FontSize="14" 
                                      Margin="0,0,0,12"/>

                            <!-- ƒê∆°n v·ªã -->
                            <TextBox x:Name="txtOrgName" 
                                     materialDesign:HintAssist.Hint="T√™n ƒë∆°n v·ªã (VD: UBND x√£ Gia Ki·ªám)"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     Margin="0,0,0,12"/>

                            <!-- Lo·∫°i k·ª≥ -->
                            <ComboBox x:Name="cboPeriodType"
                                     materialDesign:HintAssist.Hint="Lo·∫°i k·ª≥ b√°o c√°o"
                                     Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                     SelectionChanged="PeriodType_Changed"
                                     Margin="0,0,0,12"/>

                            <!-- K·ª≥ b√°o c√°o -->
                            <ComboBox x:Name="cboPeriod"
                                     materialDesign:HintAssist.Hint="K·ª≥ b√°o c√°o"
                                     Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                     IsEditable="True"
                                     Margin="0,0,0,12"/>

                            <!-- Lƒ©nh v·ª±c -->
                            <ComboBox x:Name="cboField"
                                     materialDesign:HintAssist.Hint="Lƒ©nh v·ª±c"
                                     Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                     IsEditable="True"
                                     Margin="0,0,0,12"/>

                            <!-- Ng∆∞·ªùi k√Ω + Ch·ª©c danh -->
                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtSignerName" 
                                         materialDesign:HintAssist.Hint="Ng∆∞·ªùi k√Ω"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                <TextBox x:Name="txtSignerTitle" Grid.Column="2"
                                         materialDesign:HintAssist.Hint="Ch·ª©c danh"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- S·ªë li·ªáu -->
                    <materialDesign:Card Padding="16" Margin="0,0,0,12">
                        <StackPanel>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="üìà S·ªë li·ªáu k·ª≥ hi·ªán t·∫°i" 
                                          FontWeight="SemiBold" FontSize="14"/>
                                <Button x:Name="btnAutoFillStats" Grid.Column="1"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Height="30" FontSize="11" Padding="10,0"
                                        Click="AutoFillStats_Click"
                                        ToolTip="T·ª± ƒë·ªông tr√≠ch xu·∫•t s·ªë li·ªáu t·ª´ s·ªï vƒÉn b·∫£n trong k·ª≥ b√°o c√°o">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="DatabaseExport" Width="16" Height="16" Margin="0,0,4,0"/>
                                        <TextBlock Text="L·∫•y t·ª´ s·ªï VB"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                            <TextBlock Text="Nh·∫≠p/paste s·ªë li·ªáu t·ª± do, ho·∫∑c nh·∫•n 'L·∫•y t·ª´ s·ªï VB' ƒë·ªÉ auto-fill t·ª´ h·ªá th·ªëng."
                                      Foreground="{DynamicResource MaterialDesignBodyLight}"
                                      FontSize="12" Margin="0,0,0,8"/>
                            
                            <TextBox x:Name="txtRawData"
                                     materialDesign:HintAssist.Hint="VD: Thu ng√¢n s√°ch: 850 tri·ªáu. H·ªô ngh√®o: 45 h·ªô..."
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="150"
                                     MaxHeight="250"
                                     VerticalScrollBarVisibility="Auto">
                                <TextBox.ToolTip>
                                    <ToolTip>
                                        <StackPanel MaxWidth="350">
                                            <TextBlock FontWeight="Bold" Margin="0,0,0,5">üí° M·∫πo nh·∫≠p s·ªë li·ªáu:</TextBlock>
                                            <TextBlock TextWrapping="Wrap">Nh·∫≠p t·ª± do, m·ªói d√≤ng m·ªôt ch·ªâ ti√™u.</TextBlock>
                                            <TextBlock TextWrapping="Wrap" Margin="0,5,0,0" FontWeight="SemiBold">V√≠ d·ª•:</TextBlock>
                                            <TextBlock TextWrapping="Wrap">Thu ng√¢n s√°ch: 850 tri·ªáu (KH: 900 tri·ªáu)</TextBlock>
                                            <TextBlock TextWrapping="Wrap">H·ªô ngh√®o: 45 h·ªô (th√°ng tr∆∞·ªõc: 47)</TextBlock>
                                            <TextBlock TextWrapping="Wrap">Gi·∫£i quy·∫øt TTHC: 312 h·ªì s∆°, tr·ªÖ h·∫°n: 5</TextBlock>
                                            <TextBlock TextWrapping="Wrap">DVC tr·ª±c tuy·∫øn: 420 h·ªì s∆°</TextBlock>
                                            <TextBlock TextWrapping="Wrap" Margin="0,5,0,0" Foreground="#1565C0">AI s·∫Ω t·ª± t√≠nh %, tƒÉng/gi·∫£m, t·ª∑ l·ªá.</TextBlock>
                                        </StackPanel>
                                    </ToolTip>
                                </TextBox.ToolTip>
                            </TextBox>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- BC k·ª≥ tr∆∞·ªõc -->
                    <materialDesign:Card Padding="16" Margin="0,0,0,12">
                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="üìã B√°o c√°o k·ª≥ tr∆∞·ªõc (t√πy ch·ªçn)" 
                                          FontWeight="SemiBold" FontSize="14"
                                          VerticalAlignment="Center"/>
                                <ComboBox x:Name="cboPreviousReport"
                                         Grid.Column="1"
                                         materialDesign:HintAssist.Hint="Ch·ªçn t·ª´ DB"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         Width="160" FontSize="12"
                                         DisplayMemberPath="Title"
                                         SelectionChanged="PreviousReport_Changed"/>
                            </Grid>
                            <TextBlock Text="Paste n·ªôi dung BC k·ª≥ tr∆∞·ªõc ƒë·ªÉ AI so s√°nh t·ª± ƒë·ªông."
                                      Foreground="{DynamicResource MaterialDesignBodyLight}"
                                      FontSize="12" Margin="0,0,0,8"/>
                            
                            <TextBox x:Name="txtPreviousReport"
                                     materialDesign:HintAssist.Hint="N·ªôi dung b√°o c√°o k·ª≥ tr∆∞·ªõc (ho·∫∑c ch·ªçn t·ª´ DB ·ªü tr√™n)"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="100"
                                     MaxHeight="200"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </materialDesign:Card>


                </StackPanel>
            </ScrollViewer>

            <!-- RIGHT: Preview / Result -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title + Generate button -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="üìÑ K·∫øt qu·∫£ b√°o c√°o" 
                              FontWeight="SemiBold" FontSize="14"
                              VerticalAlignment="Center"/>

                    <Button x:Name="btnGenerate" Grid.Column="1"
                           Style="{StaticResource MaterialDesignRaisedButton}"
                           Background="#00796B" Foreground="White"
                           Click="Generate_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Creation" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="ü§ñ T·∫°o b√°o c√°o"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- Loading -->
                <StackPanel x:Name="LoadingPanel" Grid.Row="1" 
                           VerticalAlignment="Center" HorizontalAlignment="Center"
                           Visibility="Collapsed">
                    <ProgressBar IsIndeterminate="True" Width="200" Margin="0,0,0,12"/>
                    <TextBlock x:Name="txtLoading" Text="‚è≥ AI ƒëang ph√¢n t√≠ch s·ªë li·ªáu v√† so·∫°n b√°o c√°o..."
                              HorizontalAlignment="Center"
                              Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                </StackPanel>

                <!-- Placeholder -->
                <StackPanel x:Name="PlaceholderPanel" Grid.Row="1" 
                           VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="üìä" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                    <TextBlock Text="Nh·∫≠p th√¥ng tin b√™n tr√°i r·ªìi b·∫•m &quot;T·∫°o b√°o c√°o&quot;"
                              HorizontalAlignment="Center" FontSize="14"
                              Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                    <TextBlock Text="AI s·∫Ω t·ª± t√≠nh to√°n, so s√°nh v√† so·∫°n b√°o c√°o ho√†n ch·ªânh"
                              HorizontalAlignment="Center" FontSize="12" Margin="0,4,0,0"
                              Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                </StackPanel>

                <!-- Result -->
                <materialDesign:Card x:Name="ResultCard" Grid.Row="1" 
                                    Padding="0" Visibility="Collapsed">
                    <RichTextBox x:Name="ResultRichTextBox"
                                BorderThickness="0"
                                IsReadOnly="True"
                                VerticalScrollBarVisibility="Auto"
                                Padding="16"
                                FontFamily="Times New Roman"
                                FontSize="14">
                        <RichTextBox.Document>
                            <FlowDocument/>
                        </RichTextBox.Document>
                    </RichTextBox>
                </materialDesign:Card>

                <!-- Action buttons -->
                <StackPanel x:Name="ActionButtons" Grid.Row="2" 
                           Orientation="Horizontal" HorizontalAlignment="Right"
                           Margin="0,8,0,0"
                           Visibility="Collapsed">
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                           Content="üìã Copy" Click="Copy_Click" Margin="0,0,8,0"/>
                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                           Content="üíæ Xu·∫•t Word" Click="ExportWord_Click" Margin="0,0,8,0"/>
                    <Button x:Name="btnSaveAsDocument"
                           Style="{StaticResource MaterialDesignRaisedButton}"
                           Content="üíæ L∆∞u v√†o kho VB" Click="SaveAsDocument_Click"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <TextBlock Text="‚ö†Ô∏è K·∫øt qu·∫£ AI ƒë·ªÉ tham kh·∫£o, c·∫ßn ki·ªÉm tra l·∫°i tr∆∞·ªõc khi s·ª≠ d·ª•ng."
                      VerticalAlignment="Center" FontSize="11" Margin="0,0,16,0"
                      Foreground="{DynamicResource MaterialDesignBodyLight}"/>
            <Button Style="{StaticResource MaterialDesignFlatButton}"
                   Content="ƒê√≥ng" Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>
